<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Swapping Out the Infrastructure: Do Everything with CSVs</title>
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */

@import url(//fonts.googleapis.com/css?family=Noto+Sans);
@import url(//asciidoctor.org/stylesheets/asciidoctor.css); /* Default asciidoc style framework - important */

/* customisations by harry */

h1, h2, h3, h4, h5, h6 {
    position: relative;
}

a.anchor {
    top: 0;
}

/* hide inline ditaa/plantuml source listings for images */
.image-source {
    display: none
}
/* make formal codeblocks a bit nicer */
.exampleblock > .content {
    padding: 2px;
    background-color: white;
    border: 0;
    margin-bottom: 2em;
}
.exampleblock .title {
    text-align: right;
}

/* prev/next chapter links at bottom of page */
.prev_and_next_chapter_links {
    margin: 10px;
}
.prev_chapter_link {
    float: left;
}
.next_chapter_link {
    float: right;
}


/* a few tweaks to existing styles */
#toc li {
    margin-top: 0.5em;
}

#footnotes hr {
    width: 100%;
}

/* end customisations by harry */


/* CUSTOMISATIONS */
/* Change the values in root for quick customisation. If you want even more fine grain... venture further. */
:root{
--maincolor:#282c34;
--primarycolor:#f39c12;
--secondarycolor:#03a9f4;
--tertiarycolor:#4db6ac;
--sidebarbackground:#21252b;
--linkcolor:#f44336;
--linkcoloralternate:#ff9800;
--white:#FFFFFF;
}

/* Text styles */

body{font-family: "Noto Sans",sans-serif;background-color: var(--maincolor);color:var(--white);}

h1{color:var(--primarycolor) !important;font-family:"Noto Sans",sans-serif;}
h2,h3,h4,h5,h6{color:var(--secondarycolor) !important;font-family:"Noto Sans",sans-serif;}
.title{color:var(--white) !important;font-family:"Noto Sans",sans-serif;font-style: normal; font-weight: normal;}
p{font-family: "Noto Sans",sans-serif ! important}
#toc.toc2 a:link{color:var(--linkcolor);}
blockquote{color:var(--tertiarycolor) !important}
.quoteblock{color:var(--white)}
code{color:var(--linkcoloralternate);background-color: var(--sidebarbackground) !important}


/* Table styles */
th{background-color: var(--maincolor);color:var(--white) !important;}
td{background-color: var(--maincolor);color: var(--linkcoloralternate) !important}


#toc.toc2{background-color:var(--sidebarbackground);}
#toctitle{color:var(--white);}

/* Responsiveness fixes */
video {
  max-width: 100%;
}

@media all and (max-width: 600px) {
  table {
    width: 55vw!important;
    font-size: 3vw;
  }
}

.exampleblock > .content {
  background-color: var(--maincolor);
}

a {
  color: var(--secondarycolor);
}

.admonitionblock td.icon .icon-tip::before {
  text-shadow: none;
  color: var(--white);
}
.admonitionblock td.icon .icon-note::before {
  color: var(--tertiarycolor);
}
.admonitionblock td.icon .icon-important::before {
  color: var(--linkcolor);
}
/*.admonitionblock td.icon .icon-caution::before {
  color: var(--linkcoloralternate);
}*/
.admonitionblock td.icon .icon-warning::before {
  color: var(--primarycolor);
}

#preamble > .sectionbody > .paragraph:first-of-type p {
  color: var(--white);
}

.quoteblock blockquote::before {
  color: var(--primarycolor);
}
.quoteblock .attribution cite, .verseblock .attribution cite {
  color: var(--white);
}
.verseblock pre {
  color: var(--white);
}
.quoteblock blockquote, .quoteblock blockquote p {
  color: var(--white);
}

.sidebarblock {
  background: var(--sidebarbackground);
}
.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint {
  background: var(--sidebarbackground);
  color: var(--white);
}

#header .details {
  color: var(--white);
}
#header .details span.email a {
  color: var(--linkcoloralternate);
}


</style>
</head>
<body class="article toc2 toc-left">
<div id="buy_the_book" style="position: absolute; top: 0; right: 0; z-index:100">
  <a href="/#buy_the_book">
    <img src="/images/buy_the_book.svg" alt="buy the book ribbon">
  </a>
</div>
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="/book/preface.html">Preface</a></li>
<li><a href="/book/introduction.html">Introduction</a></li>
<li><a href="/book/part1.html">Part 1: Building an Architecture to Support Domain Modeling</a></li>
<li><a href="/book/chapter_01_domain_model.html">1. Domain Modeling</a></li>
<li><a href="/book/chapter_02_repository.html">2. Repository Pattern</a></li>
<li><a href="/book/chapter_03_abstractions.html">3. A Brief Interlude: On Coupling <span class="keep-together">and Abstractions</span></a></li>
<li><a href="/book/chapter_04_service_layer.html">4. Our First Use Case: <span class="keep-together">Flask API and Service Layer</span></a></li>
<li><a href="/book/chapter_05_high_gear_low_gear.html">5. TDD in High Gear and Low Gear</a></li>
<li><a href="/book/chapter_06_uow.html">6. Unit of Work Pattern</a></li>
<li><a href="/book/chapter_07_aggregate.html">7. Aggregates and Consistency Boundaries</a></li>
<li><a href="/book/part2.html">Part 2: Event-Driven Architecture</a></li>
<li><a href="/book/chapter_08_events_and_message_bus.html">8. Events and the Message Bus</a></li>
<li><a href="/book/chapter_09_all_messagebus.html">9. Going to Town on the Message Bus</a></li>
<li><a href="/book/chapter_10_commands.html">10. Commands and Command Handler</a></li>
<li><a href="/book/chapter_11_external_events.html">11. Event-Driven Architecture: Using Events to Integrate Microservices</a></li>
<li><a href="/book/chapter_12_cqrs.html">12. Command-Query Responsibility Segregation (CQRS)</a></li>
<li><a href="/book/chapter_13_dependency_injection.html">13. Dependency Injection (and Bootstrapping)</a></li>
<li><a href="/book/epilogue_1_how_to_get_there_from_here.html">Epilogue: Epilogue</a></li>
<li><a href="/book/appendix_ds1_table.html">Appendix A: Summary Diagram and Table</a></li>
<li><a href="/book/appendix_project_structure.html">Appendix B: A Template Project Structure</a></li>
<li><a href="/book/appendix_csvs.html">Appendix C: Swapping Out the Infrastructure: Do Everything with CSVs</a></li>
<li><a href="/book/appendix_django.html">Appendix D: Repository and Unit of Work Patterns with Django</a></li>
<li><a href="/book/appendix_validation.html">Appendix E: Validation</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="appendix_csvs">Appendix C: Swapping Out the Infrastructure: Do Everything with CSVs<a class="anchor" href="#appendix_csvs"></a>Appendix A: Swapping Out the Infrastructure: </h2>
<div class="sectionbody">
<div class="paragraph">
<p>
This appendix is intended as a little illustration of the benefits of the
Repository, Unit of Work, and Service Layer patterns. It&#8217;s intended to
follow from <a href="/book/chapter_06_uow.html">[chapter_06_uow]</a>.</p>
</div>
<div class="paragraph">
<p>Just as we finish building out our Flask API and getting it ready for release,
the business comes to us apologetically, saying they&#8217;re not ready to use our API
and asking if we could build a thing that reads just batches and orders from a couple of
CSVs and outputs a third CSV with allocations.</p>
</div>
<div class="paragraph">
<p>Ordinarily this is the kind of thing that might have a team cursing and spitting
and making notes for their memoirs.  But not us!  Oh no, we&#8217;ve ensured that
our infrastructure concerns are nicely decoupled from our domain model and
service layer.  Switching to CSVs will be a simple matter of writing a couple
of new <code>Repository</code> and <code>UnitOfWork</code> classes, and then we&#8217;ll be able to reuse
<em>all</em> of our logic from the domain layer and the service layer.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an E2E test to show you how the CSVs flow in and out:</p>
</div>
<div id="first_csv_test" class="exampleblock">
<div class="title">A first CSV test (tests/e2e/test_csv.py)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span> <span class="tok-nf">test_cli_app_reads_csvs_with_batches_and_orders_and_outputs_allocations</span><span class="tok-p">(</span>
        <span class="tok-n">make_csv</span>
<span class="tok-p">):</span>
    <span class="tok-n">sku1</span><span class="tok-p">,</span> <span class="tok-n">sku2</span> <span class="tok-o">=</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'s1'</span><span class="tok-p">),</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'s2'</span><span class="tok-p">)</span>
    <span class="tok-n">batch1</span><span class="tok-p">,</span> <span class="tok-n">batch2</span><span class="tok-p">,</span> <span class="tok-n">batch3</span> <span class="tok-o">=</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'b1'</span><span class="tok-p">),</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'b2'</span><span class="tok-p">),</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'b3'</span><span class="tok-p">)</span>
    <span class="tok-n">order_ref</span> <span class="tok-o">=</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'o'</span><span class="tok-p">)</span>
    <span class="tok-n">make_csv</span><span class="tok-p">(</span><span class="tok-s1">'batches.csv'</span><span class="tok-p">,</span> <span class="tok-p">[</span>
        <span class="tok-p">[</span><span class="tok-s1">'ref'</span><span class="tok-p">,</span> <span class="tok-s1">'sku'</span><span class="tok-p">,</span> <span class="tok-s1">'qty'</span><span class="tok-p">,</span> <span class="tok-s1">'eta'</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">batch1</span><span class="tok-p">,</span> <span class="tok-n">sku1</span><span class="tok-p">,</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-s1">''</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">batch2</span><span class="tok-p">,</span> <span class="tok-n">sku2</span><span class="tok-p">,</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-s1">'2011-01-01'</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">batch3</span><span class="tok-p">,</span> <span class="tok-n">sku2</span><span class="tok-p">,</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-s1">'2011-01-02'</span><span class="tok-p">],</span>
    <span class="tok-p">])</span>
    <span class="tok-n">orders_csv</span> <span class="tok-o">=</span> <span class="tok-n">make_csv</span><span class="tok-p">(</span><span class="tok-s1">'orders.csv'</span><span class="tok-p">,</span> <span class="tok-p">[</span>
        <span class="tok-p">[</span><span class="tok-s1">'orderid'</span><span class="tok-p">,</span> <span class="tok-s1">'sku'</span><span class="tok-p">,</span> <span class="tok-s1">'qty'</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">order_ref</span><span class="tok-p">,</span> <span class="tok-n">sku1</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">order_ref</span><span class="tok-p">,</span> <span class="tok-n">sku2</span><span class="tok-p">,</span> <span class="tok-mi">12</span><span class="tok-p">],</span>
    <span class="tok-p">])</span>

    <span class="tok-n">run_cli_script</span><span class="tok-p">(</span><span class="tok-n">orders_csv</span><span class="tok-o">.</span><span class="tok-n">parent</span><span class="tok-p">)</span>

    <span class="tok-n">expected_output_csv</span> <span class="tok-o">=</span> <span class="tok-n">orders_csv</span><span class="tok-o">.</span><span class="tok-n">parent</span> <span class="tok-o">/</span> <span class="tok-s1">'allocations.csv'</span>
    <span class="tok-k">with</span> <span class="tok-nb">open</span><span class="tok-p">(</span><span class="tok-n">expected_output_csv</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-n">f</span><span class="tok-p">:</span>
        <span class="tok-n">rows</span> <span class="tok-o">=</span> <span class="tok-nb">list</span><span class="tok-p">(</span><span class="tok-n">csv</span><span class="tok-o">.</span><span class="tok-n">reader</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">))</span>
    <span class="tok-k">assert</span> <span class="tok-n">rows</span> <span class="tok-o">==</span> <span class="tok-p">[</span>
        <span class="tok-p">[</span><span class="tok-s1">'orderid'</span><span class="tok-p">,</span> <span class="tok-s1">'sku'</span><span class="tok-p">,</span> <span class="tok-s1">'qty'</span><span class="tok-p">,</span> <span class="tok-s1">'batchref'</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">order_ref</span><span class="tok-p">,</span> <span class="tok-n">sku1</span><span class="tok-p">,</span> <span class="tok-s1">'3'</span><span class="tok-p">,</span> <span class="tok-n">batch1</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">order_ref</span><span class="tok-p">,</span> <span class="tok-n">sku2</span><span class="tok-p">,</span> <span class="tok-s1">'12'</span><span class="tok-p">,</span> <span class="tok-n">batch2</span><span class="tok-p">],</span>
    <span class="tok-p">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Diving in and implementing without thinking about repositories and all
that jazz, you might start with something like this:</p>
</div>
<div id="first_cut_csvs" class="exampleblock">
<div class="title">A first cut of our CSV reader/writer (src/bin/allocate-from-csv)</div>
<div class="content">
<div class="listingblock non-head">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-ch">#!/usr/bin/env python</span>
<span class="tok-kn">import</span> <span class="tok-nn">csv</span>
<span class="tok-kn">import</span> <span class="tok-nn">sys</span>
<span class="tok-kn">from</span> <span class="tok-nn">datetime</span> <span class="tok-kn">import</span> <span class="tok-n">datetime</span>
<span class="tok-kn">from</span> <span class="tok-nn">pathlib</span> <span class="tok-kn">import</span> <span class="tok-n">Path</span>

<span class="tok-kn">from</span> <span class="tok-nn">allocation</span> <span class="tok-kn">import</span> <span class="tok-n">model</span>

<span class="tok-k">def</span> <span class="tok-nf">load_batches</span><span class="tok-p">(</span><span class="tok-n">batches_path</span><span class="tok-p">):</span>
    <span class="tok-n">batches</span> <span class="tok-o">=</span> <span class="tok-p">[]</span>
    <span class="tok-k">with</span> <span class="tok-n">batches_path</span><span class="tok-o">.</span><span class="tok-n">open</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">inf</span><span class="tok-p">:</span>
        <span class="tok-n">reader</span> <span class="tok-o">=</span> <span class="tok-n">csv</span><span class="tok-o">.</span><span class="tok-n">DictReader</span><span class="tok-p">(</span><span class="tok-n">inf</span><span class="tok-p">)</span>
        <span class="tok-k">for</span> <span class="tok-n">row</span> <span class="tok-ow">in</span> <span class="tok-n">reader</span><span class="tok-p">:</span>
            <span class="tok-k">if</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'eta'</span><span class="tok-p">]:</span>
                <span class="tok-n">eta</span> <span class="tok-o">=</span> <span class="tok-n">datetime</span><span class="tok-o">.</span><span class="tok-n">strptime</span><span class="tok-p">(</span><span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'eta'</span><span class="tok-p">],</span> <span class="tok-s1">'%Y-%m-</span><span class="tok-si">%d</span><span class="tok-s1">'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">date</span><span class="tok-p">()</span>
            <span class="tok-k">else</span><span class="tok-p">:</span>
                <span class="tok-n">eta</span> <span class="tok-o">=</span> <span class="tok-bp">None</span>
            <span class="tok-n">batches</span><span class="tok-o">.</span><span class="tok-n">append</span><span class="tok-p">(</span><span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-n">Batch</span><span class="tok-p">(</span>
                <span class="tok-n">ref</span><span class="tok-o">=</span><span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'ref'</span><span class="tok-p">],</span>
                <span class="tok-n">sku</span><span class="tok-o">=</span><span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'sku'</span><span class="tok-p">],</span>
                <span class="tok-n">qty</span><span class="tok-o">=</span><span class="tok-nb">int</span><span class="tok-p">(</span><span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'qty'</span><span class="tok-p">]),</span>
                <span class="tok-n">eta</span><span class="tok-o">=</span><span class="tok-n">eta</span>
            <span class="tok-p">))</span>
    <span class="tok-k">return</span> <span class="tok-n">batches</span>



<span class="tok-k">def</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">):</span>
    <span class="tok-n">batches_path</span> <span class="tok-o">=</span> <span class="tok-n">Path</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">)</span> <span class="tok-o">/</span> <span class="tok-s1">'batches.csv'</span>
    <span class="tok-n">orders_path</span> <span class="tok-o">=</span> <span class="tok-n">Path</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">)</span> <span class="tok-o">/</span> <span class="tok-s1">'orders.csv'</span>
    <span class="tok-n">allocations_path</span> <span class="tok-o">=</span> <span class="tok-n">Path</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">)</span> <span class="tok-o">/</span> <span class="tok-s1">'allocations.csv'</span>

    <span class="tok-n">batches</span> <span class="tok-o">=</span> <span class="tok-n">load_batches</span><span class="tok-p">(</span><span class="tok-n">batches_path</span><span class="tok-p">)</span>

    <span class="tok-k">with</span> <span class="tok-n">orders_path</span><span class="tok-o">.</span><span class="tok-n">open</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">inf</span><span class="tok-p">,</span> <span class="tok-n">allocations_path</span><span class="tok-o">.</span><span class="tok-n">open</span><span class="tok-p">(</span><span class="tok-s1">'w'</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-n">outf</span><span class="tok-p">:</span>
        <span class="tok-n">reader</span> <span class="tok-o">=</span> <span class="tok-n">csv</span><span class="tok-o">.</span><span class="tok-n">DictReader</span><span class="tok-p">(</span><span class="tok-n">inf</span><span class="tok-p">)</span>
        <span class="tok-n">writer</span> <span class="tok-o">=</span> <span class="tok-n">csv</span><span class="tok-o">.</span><span class="tok-n">writer</span><span class="tok-p">(</span><span class="tok-n">outf</span><span class="tok-p">)</span>
        <span class="tok-n">writer</span><span class="tok-o">.</span><span class="tok-n">writerow</span><span class="tok-p">([</span><span class="tok-s1">'orderid'</span><span class="tok-p">,</span> <span class="tok-s1">'sku'</span><span class="tok-p">,</span> <span class="tok-s1">'batchref'</span><span class="tok-p">])</span>
        <span class="tok-k">for</span> <span class="tok-n">row</span> <span class="tok-ow">in</span> <span class="tok-n">reader</span><span class="tok-p">:</span>
            <span class="tok-n">orderid</span><span class="tok-p">,</span> <span class="tok-n">sku</span> <span class="tok-o">=</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'orderid'</span><span class="tok-p">],</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'sku'</span><span class="tok-p">]</span>
            <span class="tok-n">qty</span> <span class="tok-o">=</span> <span class="tok-nb">int</span><span class="tok-p">(</span><span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'qty'</span><span class="tok-p">])</span>
            <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-n">OrderLine</span><span class="tok-p">(</span><span class="tok-n">orderid</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-n">qty</span><span class="tok-p">)</span>
            <span class="tok-n">batchref</span> <span class="tok-o">=</span> <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-n">allocate</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">,</span> <span class="tok-n">batches</span><span class="tok-p">)</span>
            <span class="tok-n">writer</span><span class="tok-o">.</span><span class="tok-n">writerow</span><span class="tok-p">([</span><span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-n">orderid</span><span class="tok-p">,</span> <span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-n">batchref</span><span class="tok-p">])</span>



<span class="tok-k">if</span> <span class="tok-vm">__name__</span> <span class="tok-o">==</span> <span class="tok-s1">'__main__'</span><span class="tok-p">:</span>
    <span class="tok-n">main</span><span class="tok-p">(</span><span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">])</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s not looking too bad! And we&#8217;re reusing our domain model objects
and our domain service.</p>
</div>
<div class="paragraph">
<p>But it&#8217;s not going to work. Existing allocations need to also be part
of our permanent CSV storage. We can write a second test to force us to improve
things:</p>
</div>
<div id="second_csv_test" class="exampleblock">
<div class="title">And another one, with existing allocations (tests/e2e/test_csv.py)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span> <span class="tok-nf">test_cli_app_also_reads_existing_allocations_and_can_append_to_them</span><span class="tok-p">(</span>
        <span class="tok-n">make_csv</span>
<span class="tok-p">):</span>
    <span class="tok-n">sku</span> <span class="tok-o">=</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'s'</span><span class="tok-p">)</span>
    <span class="tok-n">batch1</span><span class="tok-p">,</span> <span class="tok-n">batch2</span> <span class="tok-o">=</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'b1'</span><span class="tok-p">),</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'b2'</span><span class="tok-p">)</span>
    <span class="tok-n">old_order</span><span class="tok-p">,</span> <span class="tok-n">new_order</span> <span class="tok-o">=</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'o1'</span><span class="tok-p">),</span> <span class="tok-n">random_ref</span><span class="tok-p">(</span><span class="tok-s1">'o2'</span><span class="tok-p">)</span>
    <span class="tok-n">make_csv</span><span class="tok-p">(</span><span class="tok-s1">'batches.csv'</span><span class="tok-p">,</span> <span class="tok-p">[</span>
        <span class="tok-p">[</span><span class="tok-s1">'ref'</span><span class="tok-p">,</span> <span class="tok-s1">'sku'</span><span class="tok-p">,</span> <span class="tok-s1">'qty'</span><span class="tok-p">,</span> <span class="tok-s1">'eta'</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">batch1</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-s1">'2011-01-01'</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">batch2</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-s1">'2011-01-02'</span><span class="tok-p">],</span>
    <span class="tok-p">])</span>
    <span class="tok-n">make_csv</span><span class="tok-p">(</span><span class="tok-s1">'allocations.csv'</span><span class="tok-p">,</span> <span class="tok-p">[</span>
        <span class="tok-p">[</span><span class="tok-s1">'orderid'</span><span class="tok-p">,</span> <span class="tok-s1">'sku'</span><span class="tok-p">,</span> <span class="tok-s1">'qty'</span><span class="tok-p">,</span> <span class="tok-s1">'batchref'</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">old_order</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-n">batch1</span><span class="tok-p">],</span>
    <span class="tok-p">])</span>
    <span class="tok-n">orders_csv</span> <span class="tok-o">=</span> <span class="tok-n">make_csv</span><span class="tok-p">(</span><span class="tok-s1">'orders.csv'</span><span class="tok-p">,</span> <span class="tok-p">[</span>
        <span class="tok-p">[</span><span class="tok-s1">'orderid'</span><span class="tok-p">,</span> <span class="tok-s1">'sku'</span><span class="tok-p">,</span> <span class="tok-s1">'qty'</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">new_order</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">],</span>
    <span class="tok-p">])</span>

    <span class="tok-n">run_cli_script</span><span class="tok-p">(</span><span class="tok-n">orders_csv</span><span class="tok-o">.</span><span class="tok-n">parent</span><span class="tok-p">)</span>

    <span class="tok-n">expected_output_csv</span> <span class="tok-o">=</span> <span class="tok-n">orders_csv</span><span class="tok-o">.</span><span class="tok-n">parent</span> <span class="tok-o">/</span> <span class="tok-s1">'allocations.csv'</span>
    <span class="tok-k">with</span> <span class="tok-nb">open</span><span class="tok-p">(</span><span class="tok-n">expected_output_csv</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-n">f</span><span class="tok-p">:</span>
        <span class="tok-n">rows</span> <span class="tok-o">=</span> <span class="tok-nb">list</span><span class="tok-p">(</span><span class="tok-n">csv</span><span class="tok-o">.</span><span class="tok-n">reader</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">))</span>
    <span class="tok-k">assert</span> <span class="tok-n">rows</span> <span class="tok-o">==</span> <span class="tok-p">[</span>
        <span class="tok-p">[</span><span class="tok-s1">'orderid'</span><span class="tok-p">,</span> <span class="tok-s1">'sku'</span><span class="tok-p">,</span> <span class="tok-s1">'qty'</span><span class="tok-p">,</span> <span class="tok-s1">'batchref'</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">old_order</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-s1">'10'</span><span class="tok-p">,</span> <span class="tok-n">batch1</span><span class="tok-p">],</span>
        <span class="tok-p">[</span><span class="tok-n">new_order</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-s1">'7'</span><span class="tok-p">,</span> <span class="tok-n">batch2</span><span class="tok-p">],</span>
    <span class="tok-p">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And we could keep hacking about and adding extra lines to that <code>load_batches</code> function,
and some sort of way of tracking and saving new allocations&#8212;but we already have a model for doing that! It&#8217;s called our Repository and Unit of Work patterns.</p>
</div>
<div class="paragraph">
<p>All we need to do ("all we need to do") is reimplement those same abstractions, but
with CSVs underlying them instead of a database. And as you&#8217;ll see, it really is relatively straightforward.</p>
</div>
<div class="sect2">
<h3 id="_implementing_a_repository_and_unit_of_work_for_csvs"><a class="anchor" href="#_implementing_a_repository_and_unit_of_work_for_csvs"></a>Implementing a Repository and Unit of Work for CSVs</h3>
<div class="paragraph">
<p>
Here&#8217;s what a CSV-based repository could look like.  It abstracts away all the
logic for reading CSVs from disk, including the fact that it has to read <em>two
different CSVs</em> (one for batches and one for allocations), and it gives us just
the familiar <code>.list()</code> API, which provides the illusion of an in-memory
collection of domain objects:</p>
</div>
<div id="csv_repository" class="exampleblock">
<div class="title">A repository that uses CSV as its storage mechanism (src/allocation/service_layer/csv_uow.py)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">class</span> <span class="tok-nc">CsvRepository</span><span class="tok-p">(</span><span class="tok-n">repository</span><span class="tok-o">.</span><span class="tok-n">AbstractRepository</span><span class="tok-p">):</span>

    <span class="tok-k">def</span> <span class="tok-fm">__init__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">folder</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_batches_path</span> <span class="tok-o">=</span> <span class="tok-n">Path</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">)</span> <span class="tok-o">/</span> <span class="tok-s1">'batches.csv'</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_allocations_path</span> <span class="tok-o">=</span> <span class="tok-n">Path</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">)</span> <span class="tok-o">/</span> <span class="tok-s1">'allocations.csv'</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_batches</span> <span class="tok-o">=</span> <span class="tok-p">{}</span>  <span class="tok-c1"># type: Dict[str, model.Batch]</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_load</span><span class="tok-p">()</span>

    <span class="tok-k">def</span> <span class="tok-nf">get</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">reference</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_batches</span><span class="tok-o">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">reference</span><span class="tok-p">)</span>

    <span class="tok-k">def</span> <span class="tok-nf">add</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">batch</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_batches</span><span class="tok-p">[</span><span class="tok-n">batch</span><span class="tok-o">.</span><span class="tok-n">reference</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">batch</span>

    <span class="tok-k">def</span> <span class="tok-nf">_load</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">with</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_batches_path</span><span class="tok-o">.</span><span class="tok-n">open</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">f</span><span class="tok-p">:</span>
            <span class="tok-n">reader</span> <span class="tok-o">=</span> <span class="tok-n">csv</span><span class="tok-o">.</span><span class="tok-n">DictReader</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">)</span>
            <span class="tok-k">for</span> <span class="tok-n">row</span> <span class="tok-ow">in</span> <span class="tok-n">reader</span><span class="tok-p">:</span>
                <span class="tok-n">ref</span><span class="tok-p">,</span> <span class="tok-n">sku</span> <span class="tok-o">=</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'ref'</span><span class="tok-p">],</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'sku'</span><span class="tok-p">]</span>
                <span class="tok-n">qty</span> <span class="tok-o">=</span> <span class="tok-nb">int</span><span class="tok-p">(</span><span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'qty'</span><span class="tok-p">])</span>
                <span class="tok-k">if</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'eta'</span><span class="tok-p">]:</span>
                    <span class="tok-n">eta</span> <span class="tok-o">=</span> <span class="tok-n">datetime</span><span class="tok-o">.</span><span class="tok-n">strptime</span><span class="tok-p">(</span><span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'eta'</span><span class="tok-p">],</span> <span class="tok-s1">'%Y-%m-</span><span class="tok-si">%d</span><span class="tok-s1">'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">date</span><span class="tok-p">()</span>
                <span class="tok-k">else</span><span class="tok-p">:</span>
                    <span class="tok-n">eta</span> <span class="tok-o">=</span> <span class="tok-bp">None</span>
                <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_batches</span><span class="tok-p">[</span><span class="tok-n">ref</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-n">Batch</span><span class="tok-p">(</span>
                    <span class="tok-n">ref</span><span class="tok-o">=</span><span class="tok-n">ref</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-o">=</span><span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-n">qty</span><span class="tok-o">=</span><span class="tok-n">qty</span><span class="tok-p">,</span> <span class="tok-n">eta</span><span class="tok-o">=</span><span class="tok-n">eta</span>
                <span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_allocations_path</span><span class="tok-o">.</span><span class="tok-n">exists</span><span class="tok-p">()</span> <span class="tok-ow">is</span> <span class="tok-bp">False</span><span class="tok-p">:</span>
            <span class="tok-k">return</span>
        <span class="tok-k">with</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_allocations_path</span><span class="tok-o">.</span><span class="tok-n">open</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">f</span><span class="tok-p">:</span>
            <span class="tok-n">reader</span> <span class="tok-o">=</span> <span class="tok-n">csv</span><span class="tok-o">.</span><span class="tok-n">DictReader</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">)</span>
            <span class="tok-k">for</span> <span class="tok-n">row</span> <span class="tok-ow">in</span> <span class="tok-n">reader</span><span class="tok-p">:</span>
                <span class="tok-n">batchref</span><span class="tok-p">,</span> <span class="tok-n">orderid</span><span class="tok-p">,</span> <span class="tok-n">sku</span> <span class="tok-o">=</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'batchref'</span><span class="tok-p">],</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'orderid'</span><span class="tok-p">],</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'sku'</span><span class="tok-p">]</span>
                <span class="tok-n">qty</span> <span class="tok-o">=</span> <span class="tok-nb">int</span><span class="tok-p">(</span><span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'qty'</span><span class="tok-p">])</span>
                <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">model</span><span class="tok-o">.</span><span class="tok-n">OrderLine</span><span class="tok-p">(</span><span class="tok-n">orderid</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-n">qty</span><span class="tok-p">)</span>
                <span class="tok-n">batch</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_batches</span><span class="tok-p">[</span><span class="tok-n">batchref</span><span class="tok-p">]</span>
                <span class="tok-n">batch</span><span class="tok-o">.</span><span class="tok-n">_allocations</span><span class="tok-o">.</span><span class="tok-n">add</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span>

    <span class="tok-k">def</span> <span class="tok-nf">list</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-nb">list</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_batches</span><span class="tok-o">.</span><span class="tok-n">values</span><span class="tok-p">())</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>
And here&#8217;s what a UoW for CSVs would look like:</p>
</div>
<div id="csvs_uow" class="exampleblock">
<div class="title">A UoW for CSVs: commit = csv.writer (src/allocation/service_layer/csv_uow.py)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">class</span> <span class="tok-nc">CsvUnitOfWork</span><span class="tok-p">(</span><span class="tok-n">unit_of_work</span><span class="tok-o">.</span><span class="tok-n">AbstractUnitOfWork</span><span class="tok-p">):</span>

    <span class="tok-k">def</span> <span class="tok-fm">__init__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">folder</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">batches</span> <span class="tok-o">=</span> <span class="tok-n">CsvRepository</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">)</span>

    <span class="tok-k">def</span> <span class="tok-nf">commit</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">with</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">batches</span><span class="tok-o">.</span><span class="tok-n">_allocations_path</span><span class="tok-o">.</span><span class="tok-n">open</span><span class="tok-p">(</span><span class="tok-s1">'w'</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-n">f</span><span class="tok-p">:</span>
            <span class="tok-n">writer</span> <span class="tok-o">=</span> <span class="tok-n">csv</span><span class="tok-o">.</span><span class="tok-n">writer</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">)</span>
            <span class="tok-n">writer</span><span class="tok-o">.</span><span class="tok-n">writerow</span><span class="tok-p">([</span><span class="tok-s1">'orderid'</span><span class="tok-p">,</span> <span class="tok-s1">'sku'</span><span class="tok-p">,</span> <span class="tok-s1">'qty'</span><span class="tok-p">,</span> <span class="tok-s1">'batchref'</span><span class="tok-p">])</span>
            <span class="tok-k">for</span> <span class="tok-n">batch</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">batches</span><span class="tok-o">.</span><span class="tok-n">list</span><span class="tok-p">():</span>
                <span class="tok-k">for</span> <span class="tok-n">line</span> <span class="tok-ow">in</span> <span class="tok-n">batch</span><span class="tok-o">.</span><span class="tok-n">_allocations</span><span class="tok-p">:</span>
                    <span class="tok-n">writer</span><span class="tok-o">.</span><span class="tok-n">writerow</span><span class="tok-p">(</span>
                        <span class="tok-p">[</span><span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-n">orderid</span><span class="tok-p">,</span> <span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-n">qty</span><span class="tok-p">,</span> <span class="tok-n">batch</span><span class="tok-o">.</span><span class="tok-n">reference</span><span class="tok-p">]</span>
                    <span class="tok-p">)</span>

    <span class="tok-k">def</span> <span class="tok-nf">rollback</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">pass</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And once we have that, our CLI app for reading and writing batches
and allocations to CSV is pared down to what it should be&#8212;a bit
of code for reading order lines, and a bit of code that invokes our
<em>existing</em> service layer:</p>
</div>
<div id="final_cli" class="exampleblock nobreakinside less_space">
<div class="title">Allocation with CSVs in nine lines (src/bin/allocate-from-csv)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">):</span>
    <span class="tok-n">orders_path</span> <span class="tok-o">=</span> <span class="tok-n">Path</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">)</span> <span class="tok-o">/</span> <span class="tok-s1">'orders.csv'</span>
    <span class="tok-n">uow</span> <span class="tok-o">=</span> <span class="tok-n">csv_uow</span><span class="tok-o">.</span><span class="tok-n">CsvUnitOfWork</span><span class="tok-p">(</span><span class="tok-n">folder</span><span class="tok-p">)</span>
    <span class="tok-k">with</span> <span class="tok-n">orders_path</span><span class="tok-o">.</span><span class="tok-n">open</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">f</span><span class="tok-p">:</span>
        <span class="tok-n">reader</span> <span class="tok-o">=</span> <span class="tok-n">csv</span><span class="tok-o">.</span><span class="tok-n">DictReader</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">)</span>
        <span class="tok-k">for</span> <span class="tok-n">row</span> <span class="tok-ow">in</span> <span class="tok-n">reader</span><span class="tok-p">:</span>
            <span class="tok-n">orderid</span><span class="tok-p">,</span> <span class="tok-n">sku</span> <span class="tok-o">=</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'orderid'</span><span class="tok-p">],</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'sku'</span><span class="tok-p">]</span>
            <span class="tok-n">qty</span> <span class="tok-o">=</span> <span class="tok-nb">int</span><span class="tok-p">(</span><span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-s1">'qty'</span><span class="tok-p">])</span>
            <span class="tok-n">services</span><span class="tok-o">.</span><span class="tok-n">allocate</span><span class="tok-p">(</span><span class="tok-n">orderid</span><span class="tok-p">,</span> <span class="tok-n">sku</span><span class="tok-p">,</span> <span class="tok-n">qty</span><span class="tok-p">,</span> <span class="tok-n">uow</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>
Ta-da! <em>Now are y&#8217;all impressed or what</em>?</p>
</div>
<div class="paragraph">
<p>Much love,</p>
</div>
<div class="paragraph">
<p>Bob and Harry</p>
</div>
</div>
</div>
</div>
<div class="prev_and_next_chapter_links">
  <hr>
  <a class="prev_chapter_link" href="/book/appendix_project_structure.html">&lt;&lt; Previous - Appendix B: A Template Project Structure</a>
  <a class="next_chapter_link" href="/book/appendix_django.html">Next - Appendix D: Repository and Unit of Work Patterns with Django &gt;&gt;</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-03-20 13:47:19 UTC
</div>
</div>
<style>
pre.pygments .hll { background-color: #404040 }
pre.pygments  { background: #202020; color: #d0d0d0 }
pre.pygments .tok-c { color: #999999; font-style: italic } /* Comment */
pre.pygments .tok-err { color: #a61717; background-color: #e3d2d2 } /* Error */
pre.pygments .tok-esc { color: #d0d0d0 } /* Escape */
pre.pygments .tok-g { color: #d0d0d0 } /* Generic */
pre.pygments .tok-k { color: #6ab825; font-weight: bold } /* Keyword */
pre.pygments .tok-l { color: #d0d0d0 } /* Literal */
pre.pygments .tok-n { color: #d0d0d0 } /* Name */
pre.pygments .tok-o { color: #d0d0d0 } /* Operator */
pre.pygments .tok-x { color: #d0d0d0 } /* Other */
pre.pygments .tok-p { color: #d0d0d0 } /* Punctuation */
pre.pygments .tok-ch { color: #999999; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #999999; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #cd2828; font-weight: bold } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #999999; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #999999; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #e50808; font-weight: bold; background-color: #520000 } /* Comment.Special */
pre.pygments .tok-gd { color: #d22323 } /* Generic.Deleted */
pre.pygments .tok-ge { color: #d0d0d0; font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #d22323 } /* Generic.Error */
pre.pygments .tok-gh { color: #ffffff; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #589819 } /* Generic.Inserted */
pre.pygments .tok-go { color: #cccccc } /* Generic.Output */
pre.pygments .tok-gp { color: #aaaaaa } /* Generic.Prompt */
pre.pygments .tok-gs { color: #d0d0d0; font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #ffffff; text-decoration: underline } /* Generic.Subheading */
pre.pygments .tok-gt { color: #d22323 } /* Generic.Traceback */
pre.pygments .tok-kc { color: #6ab825; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #6ab825; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #6ab825; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #6ab825 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #6ab825; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #6ab825; font-weight: bold } /* Keyword.Type */
pre.pygments .tok-ld { color: #d0d0d0 } /* Literal.Date */
pre.pygments .tok-m { color: #3677a9 } /* Literal.Number */
pre.pygments .tok-s { color: #ed9d13 } /* Literal.String */
pre.pygments .tok-na { color: #bbbbbb } /* Name.Attribute */
pre.pygments .tok-nb { color: #24909d } /* Name.Builtin */
pre.pygments .tok-nc { color: #447fcf; text-decoration: underline } /* Name.Class */
pre.pygments .tok-no { color: #40ffff } /* Name.Constant */
pre.pygments .tok-nd { color: #ffa500 } /* Name.Decorator */
pre.pygments .tok-ni { color: #d0d0d0 } /* Name.Entity */
pre.pygments .tok-ne { color: #bbbbbb } /* Name.Exception */
pre.pygments .tok-nf { color: #447fcf } /* Name.Function */
pre.pygments .tok-nl { color: #d0d0d0 } /* Name.Label */
pre.pygments .tok-nn { color: #447fcf; text-decoration: underline } /* Name.Namespace */
pre.pygments .tok-nx { color: #d0d0d0 } /* Name.Other */
pre.pygments .tok-py { color: #d0d0d0 } /* Name.Property */
pre.pygments .tok-nt { color: #6ab825; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #40ffff } /* Name.Variable */
pre.pygments .tok-ow { color: #6ab825; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #666666 } /* Text.Whitespace */
pre.pygments .tok-mb { color: #3677a9 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #3677a9 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #3677a9 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #3677a9 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #3677a9 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #ed9d13 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #ed9d13 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #ed9d13 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #ed9d13 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #ed9d13 } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #ed9d13 } /* Literal.String.Double */
pre.pygments .tok-se { color: #ed9d13 } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #ed9d13 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #ed9d13 } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #ffa500 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #ed9d13 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #ed9d13 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #ed9d13 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #24909d } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #447fcf } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #40ffff } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #40ffff } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #40ffff } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #40ffff } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #3677a9 } /* Literal.Number.Integer.Long */
</style>
<div><div id="disqus_thread" style="margin: 10px"></div>
<script>

var disqus_config = function () {
  this.page.url = 'https://www.cosmicpython.com/book/appendix_csvs.html';
  this.page.identifier = 'cosmic-python-appendix_csvs';
};

(function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://cosmic-python.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-40928035-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-40928035-3');
</script>
</head></html></body>
</html>